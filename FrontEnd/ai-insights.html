<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Insights | WareHost</title>
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <link rel="stylesheet" href="assets/css/resources-common.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              500: '#4f46e5',
              600: '#4338ca',
            },
            secondary: {
              500: '#10b981',
              600: '#059669',
            }
          }
        }
      }
    }
  </script>
  <style>
    .insight-card {
      transition: all 0.3s ease;
    }

    .insight-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
    }

    .trend-up {
      color: #10b981;
    }

    .trend-down {
      color: #ef4444;
    }

    .ai-highlight {
      position: relative;
    }

    .ai-highlight::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, #4f46e5, #10b981);
    }

    /* Accent color matching the header teal */
    .page-accent {
      color: #3AA6A0 !important;
    }

    .page-accent-sub {
      color: rgba(34, 101, 96, 1) !important;
    }
  </style>
</head>

<body class="bg-gray-50">
  <!-- Header (shared style with resources.html) -->
  <header class="bg-[#3AA6A0] text-white shadow-md relative overflow-hidden">
    <div id="vanta-bg" class="absolute inset-0"></div>
    <div id="teal-3d-object"></div>
    <div class="container mx-auto px-4 py-4 flex justify-between items-center relative z-10">
      <div class="flex items-center space-x-2">
        <i data-feather="users" class="w-6 h-6"></i>
        <h1 class="text-2xl font-bold">WareHost</h1>
      </div>
      <nav class="hidden md:flex space-x-8">
        <a href="dashboard.html" class="text-gray-200 hover:text-white px-3 py-2 text-sm font-medium">Dashboard</a>
        <a href="inventory.html" class="text-gray-200 hover:text-white px-3 py-2 text-sm font-medium">Inventory</a>
        <a href="resources.html" class="text-white border-b-2 border-white px-3 py-2 text-sm font-medium">Resources</a>
        <a href="ai-insights-dashboard.html" class="text-gray-200 hover:text-white px-3 py-2 text-sm font-medium">AI
          Insights</a>
        <a href="promotion.html" class="text-gray-200 hover:text-white px-3 py-2 text-sm font-medium">Promotions</a>
      </nav>
    </div>
  </header>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Header -->
    <div class="mb-10">
      <div class="flex items-center mb-4 bg-[#3AA6A0] text-white rounded-lg p-4">
        <div class="p-3 rounded-lg bg-white/10 text-white mr-4">
          <i data-feather="activity" class="h-6 w-6 text-white"></i>
        </div>
        <div>
          <h1 class="text-3xl font-bold text-white">AI <span class="ai-highlight">Insights</span></h1>
          <p class="text-white">Actionable intelligence powered by machine learning</p>
        </div>
      </div>
    </div>

    <!-- Key Metrics (Dynamic from Backend) -->
    <div id="insightCards" class="grid md:grid-cols-4 gap-6 mb-10"></div>

    <!-- AI Recommendations -->
    <div class="bg-white rounded-lg shadow overflow-hidden mb-10">
      <div class="p-6 border-b border-gray-200 flex items-center justify-between">
        <h2 class="text-xl font-semibold text-gray-900">AI <span class="ai-highlight">Recommendations</span></h2>
        <button onclick="loadRecommendations()"
          class="text-sm bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-lg text-gray-700 font-medium">
          Refresh
        </button>
      </div>
      <div id="recommendations" class="divide-y divide-gray-200"></div>
    </div>


    <script>
      async function loadInsights() {
        try {
          const response = await fetch("http://localhost:8083/insights/findAll");
          const data = await response.json();
          const container = document.getElementById("insightCards");
          container.innerHTML = "";

          data.forEach(insight => {
            const card = `
      <div class="insight-card bg-white p-6 rounded-lg shadow">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-gray-500 font-medium">${insight.title}</h3>
          <i data-feather="${insight.icon}" class="text-${insight.color}-500"></i>
        </div>
        <div class="flex items-end">
          <span class="text-3xl font-bold text-gray-900">${insight.value}</span>
          ${insight.subtext ? `<span class="ml-2 text-${insight.color}-500 text-sm font-medium">${insight.subtext}</span>` : ""}
        </div>
        ${insight.footer ? `<div class="mt-2 text-sm text-gray-500">${insight.footer}</div>` : ""}
      </div>
      `;
            container.innerHTML += card;
          });

          feather.replace();
        } catch (err) {
          console.error("Error fetching insights:", err);
        }
      }

      async function loadRecommendations() {
        try {
          const response = await fetch("http://localhost:8083/recommendations/findAll");
          const data = await response.json();
          const container = document.getElementById("recommendations");
          container.innerHTML = "";

          data.forEach(rec => {
            const card = `
      <div id="rec-${rec.id}" class="p-6 flex items-start">
        <div class="flex-shrink-0 bg-${rec.color}-100 rounded-lg p-3 mr-4">
          <i data-feather="${rec.icon}" class="h-5 w-5 text-${rec.color}-600"></i>
        </div>
        <div>
          <h3 class="font-medium text-gray-900 mb-1">${rec.title}</h3>
          <p class="text-gray-600 text-sm mb-2">${rec.description}</p>
          <div class="flex space-x-4 text-sm">
            <span class="text-gray-500">Confidence: ${rec.confidence}</span>
            <span class="text-gray-500">Impact: ${rec.impact}</span>
          </div>
        </div>
        <button
          onclick="applyRecommendation(${rec.id})"
          id="btn-${rec.id}"
          class="ml-auto bg-${rec.color}-50 text-${rec.color}-600 hover:bg-${rec.color}-100 px-4 py-2 rounded-lg text-sm font-medium">
          ${rec.action}
        </button>
      </div>
      `;
            container.innerHTML += card;
          });

          feather.replace();
        } catch (err) {
          console.error("Error fetching recommendations:", err);
        }
      }

      async function applyRecommendation(id) {
        try {
          const response = await fetch(`http://localhost:8083/recommendations/${id}/apply`, {
            method: "POST"
          });
          const result = await response.text();

          // Update the UI instead of just alerting
          const button = document.getElementById(`btn-${id}`);
          if (button) {
            button.innerText = "Applied âœ…";
            button.disabled = true;
            button.classList.remove("hover:bg-" + button.classList[1]); // remove hover
            button.classList.add("opacity-50", "cursor-not-allowed");
          }

          console.log(result);
        } catch (err) {
          console.error("Error applying recommendation:", err);
          alert("Failed to apply recommendation.");
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        loadInsights();
        loadRecommendations();
      });
    </script>



    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.globe.min.js"></script>
    <script src="assets/js/resources-common.js"></script>
    <script>feather.replace();</script>
    <footer class="bg-gray-800 text-white text-center py-4 mt-8">
      <div class="max-w-7xl mx-auto px-4 flex justify-between items-center">
        <p class="text-[#3AA6A0]">&copy; 2025 WareHost. All rights reserved.</p>
        <div class="space-x-4">
          <a href="#" class="hover:text-green-400">Help</a>
          <a href="#" class="hover:text-green-400">Privacy</a>
          <a href="#" class="hover:text-green-400">Contact</a>
        </div>
      </div>
    </footer>
</body>

</html>
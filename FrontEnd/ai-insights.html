<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Insights | WareHost</title>
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <link rel="stylesheet" href="assets/css/resources-common.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              500: '#4f46e5',
              600: '#4338ca',
            },
            secondary: {
              500: '#10b981',
              600: '#059669',
            }
          }
        }
      }
    }
  </script>
  <style>
    .insight-card {
      transition: all 0.3s ease;
    }

    .insight-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
    }

    .trend-up {
      color: #10b981;
    }

    .trend-down {
      color: #ef4444;
    }

    .ai-highlight {
      position: relative;
    }

    .ai-highlight::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, #4f46e5, #10b981);
    }

    /* Accent color matching the header teal */
    .page-accent {
      color: #3AA6A0 !important;
    }

    .page-accent-sub {
      color: rgba(34, 101, 96, 1) !important;
    }
  </style>
</head>

<body class="bg-gray-50">
  <!-- Header (shared style with resources.html) -->
  <header class="bg-[#3AA6A0] text-white shadow-md relative overflow-hidden">
    <div id="vanta-bg" class="absolute inset-0"></div>
    <div id="teal-3d-object"></div>
    <div class="container mx-auto px-4 py-4 flex justify-between items-center relative z-10">
      <div class="flex items-center space-x-2">
        <i data-feather="users" class="w-6 h-6"></i>
        <h1 class="text-2xl font-bold">WareHost</h1>
      </div>
      <nav class="hidden md:flex space-x-8">
        <a href="index.html" class="text-gray-200 hover:text-white px-3 py-2 text-sm font-medium">Dashboard</a>
        <a href="inventory.html" class="text-gray-200 hover:text-white px-3 py-2 text-sm font-medium">Inventory</a>
        <a href="resources.html" class="text-gray-200 hover:text-white px-3 py-2 text-sm font-medium">Resources</a>
        <a href="ai-insights.html" class="text-white border-b-2 border-white px-3 py-2 text-sm font-medium">AI Insights
        </a>
        <a href="promotions.html" class="text-gray-200 hover:text-white px-3 py-2 text-sm font-medium">Promotions</a>
      </nav>
    </div>
  </header>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Header -->
    <div class="mb-10">
      <div class="flex items-center mb-4 bg-[#3AA6A0] text-white rounded-lg p-4">
        <div class="p-3 rounded-lg bg-white/10 text-white mr-4">
          <i data-feather="activity" class="h-6 w-6 text-white"></i>
        </div>
        <div>
          <h1 class="text-3xl font-bold text-white">AI <span class="ai-highlight">Insights</span></h1>
          <p class="text-white">Actionable intelligence powered by machine learning</p>
        </div>
      </div>
    </div>

    <!-- Key Metrics (dynamic) -->
    <div class="grid md:grid-cols-4 gap-6 mb-10" id="metricsGrid">
      <!-- Cards injected by JS -->
    </div>

    <!-- AI Recommendations (dynamic) -->
    <div class="bg-white rounded-lg shadow overflow-hidden mb-10">
      <div class="p-6 border-b border-gray-200">
        <h2 class="text-xl font-semibold text-gray-900">AI <span class="ai-highlight">Recommendations</span></h2>
      </div>
      <div id="recommendationsList" class="divide-y divide-gray-200">
        <!-- Recommendations injected by JS -->
      </div>
    </div>

    <!-- Trends Section -->
    <div class="grid md:grid-cols-2 gap-6 mb-10">
      <div class="bg-white p-6 rounded-lg shadow">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-xl font-semibold text-gray-900">Sales <span class="ai-highlight">Trends</span></h2>
          <select id="salesTrendRange"
            class="border-gray-300 rounded-lg text-sm focus:ring-primary-500 focus:border-primary-500">
            <option value="30">Last 30 Days</option>
            <option value="90">Last 90 Days</option>
            <option value="365">This Year</option>
          </select>
        </div>
        <div class="bg-gray-50 rounded-lg p-4 h-64 flex items-center justify-center" id="salesTrendChart">
          <p class="text-gray-500">Sales trend visualization will appear here</p>
        </div>
      </div>

      <div class="bg-white p-6 rounded-lg shadow">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-xl font-semibold text-gray-900">Inventory <span class="ai-highlight">Health</span></h2>
          <select id="inventoryCategory"
            class="border-gray-300 rounded-lg text-sm focus:ring-primary-500 focus:border-primary-500">
            <option value="all">All Categories</option>
            <option value="electronics" selected>Electronics</option>
            <option value="accessories">Accessories</option>
          </select>
        </div>
        <div class="bg-gray-50 rounded-lg p-4 h-64 flex items-center justify-center" id="inventoryHealthChart">
          <p class="text-gray-500">Inventory health visualization will appear here</p>
        </div>
      </div>
    </div>

    <!-- Action Plan (dynamic optional) -->
    <div class="bg-white rounded-lg shadow overflow-hidden">
      <div class="p-6 border-b border-gray-200">
        <h2 class="text-xl font-semibold text-gray-900">30-Day <span class="ai-highlight">Action Plan</span></h2>
      </div>
      <div id="actionPlanList" class="divide-y divide-gray-200">
        <!-- Action items injected by JS -->
      </div>
    </div>

    <!-- AI Insights Scripts -->
    <script>
      // Fetch helpers
      async function fetchJSON(url) {
        const res = await fetch(url);
        if (!res.ok) throw new Error(await res.text() || 'Request failed');
        return res.json();
      }

      // Render Key Metrics
      function renderMetrics(metrics) {
        const grid = document.getElementById('metricsGrid');
        grid.innerHTML = '';

        const cards = [
          {
            title: 'Inventory Turnover',
            icon: 'trending-up',
            value: metrics.inventoryTurnover?.value ?? '—',
            delta: metrics.inventoryTurnover?.delta ?? '',
            period: metrics.inventoryTurnover?.period ?? 'Last 30 days',
            color: 'text-green-500'
          },
          {
            title: 'Top Selling',
            icon: 'award',
            value: metrics.topSelling?.item ?? '—',
            subtitle: metrics.topSelling?.units ? `${metrics.topSelling.units} units sold` : '',
            color: 'text-yellow-500'
          },
          {
            title: 'Reorder Alert',
            icon: 'alert-triangle',
            value: metrics.reorderAlert?.count ? `${metrics.reorderAlert.count} Items` : '—',
            subtitle: metrics.reorderAlert?.note ?? 'Below safety stock',
            color: 'text-red-500'
          },
          {
            title: 'Revenue Forecast',
            icon: 'dollar-sign',
            value: metrics.revenueForecast?.value ? `$${metrics.revenueForecast.value}` : '—',
            delta: metrics.revenueForecast?.delta ?? '',
            period: metrics.revenueForecast?.period ?? 'Next 30 days',
            color: 'text-blue-500'
          }
        ];

        cards.forEach(c => {
          const div = document.createElement('div');
          div.className = 'insight-card bg-white p-6 rounded-lg shadow';
          div.innerHTML = `
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-gray-500 font-medium">${c.title}</h3>
          <i data-feather="${c.icon}" class="${c.color}"></i>
        </div>
        ${c.subtitle !== undefined
              ? `<div class="text-xl font-bold text-gray-900 mb-1">${c.value}</div>
             <div class="text-sm text-gray-500">${c.subtitle}</div>`
              : `<div class="flex items-end">
               <span class="text-3xl font-bold text-gray-900">${c.value}</span>
               ${c.delta ? `<span class="ml-2 text-green-500 text-sm font-medium">${c.delta}</span>` : ''}
             </div>
             <div class="mt-2 text-sm text-gray-500">${c.period}</div>`
            }
      `;
          grid.appendChild(div);
        });

        feather.replace();
      }

      // Render Recommendations
      function renderRecommendations(recos) {
        const list = document.getElementById('recommendationsList');
        list.innerHTML = '';

        if (!recos || recos.length === 0) {
          list.innerHTML = '<div class="p-6 text-gray-500">No recommendations available.</div>';
          return;
        }

        const iconMap = {
          price: { icon: 'zap', bg: 'bg-primary-100', color: 'text-primary-600' },
          reorder: { icon: 'rotate-cw', bg: 'bg-green-100', color: 'text-green-600' },
          bundle: { icon: 'tag', bg: 'bg-purple-100', color: 'text-purple-600' }
        };

        recos.forEach(r => {
          const kind = iconMap[r.type] || { icon: 'info', bg: 'bg-gray-100', color: 'text-gray-600' };
          const row = document.createElement('div');
          row.className = 'p-6 flex items-start';
          row.innerHTML = `
        <div class="flex-shrink-0 ${kind.bg} rounded-lg p-3 mr-4">
          <i data-feather="${kind.icon}" class="h-5 w-5 ${kind.color}"></i>
        </div>
        <div>
          <h3 class="font-medium text-gray-900 mb-1">${r.title || 'Recommendation'}</h3>
          <p class="text-gray-600 text-sm mb-2">${r.description || ''}</p>
          <div class="flex space-x-4 text-sm">
            ${r.confidence !== undefined ? `<span class="text-gray-500">Confidence: ${r.confidence}%</span>` : ''}
            ${r.impact ? `<span class="text-gray-500">Impact: ${r.impact}</span>` : ''}
          </div>
        </div>
        <button class="ml-auto bg-primary-50 text-primary-600 hover:bg-primary-100 px-4 py-2 rounded-lg text-sm font-medium apply-reco-btn" data-id="${r.id}">
          ${r.cta || 'Apply'}
        </button>
      `;
          list.appendChild(row);
        });

        feather.replace();
      }

      // Render Action Plan
      function renderActionPlan(items) {
        const list = document.getElementById('actionPlanList');
        list.innerHTML = '';

        if (!items || items.length === 0) {
          list.innerHTML = '<div class="p-6 text-gray-500">No actions in the plan.</div>';
          return;
        }

        const iconMap = {
          schedule: { icon: 'calendar', bg: 'bg-blue-100', color: 'text-blue-600' },
          staffing: { icon: 'users', bg: 'bg-yellow-100', color: 'text-yellow-600' },
          restock: { icon: 'truck', bg: 'bg-green-100', color: 'text-green-600' }
        };

        items.forEach(a => {
          const kind = iconMap[a.type] || { icon: 'check-circle', bg: 'bg-gray-100', color: 'text-gray-600' };
          const row = document.createElement('div');
          row.className = 'p-6 flex items-start';
          row.innerHTML = `
        <div class="flex-shrink-0 ${kind.bg} rounded-lg p-3 mr-4">
          <i data-feather="${kind.icon}" class="h-5 w-5 ${kind.color}"></i>
        </div>
        <div>
          <h3 class="font-medium text-gray-900 mb-1">${a.title || 'Action'}</h3>
          <p class="text-gray-600 text-sm">${a.description || ''}</p>
        </div>
        <div class="ml-auto text-sm text-gray-500">${a.due || ''}</div>
      `;
          list.appendChild(row);
        });

        feather.replace();
      }

      // Load Insights (metrics, recommendations, action plan)
      async function loadAIInsights() {
        try {
          // Adjust endpoints to your backend routes
          const [metrics, recos, plan] = await Promise.all([
            fetchJSON('/ai/insights/metrics'),
            fetchJSON('/ai/insights/recommendations'),
            fetchJSON('/ai/insights/action-plan')
          ]);

          renderMetrics(metrics);
          renderRecommendations(recos);
          renderActionPlan(plan);
        } catch (err) {
          console.error(err);
          // Minimal fallback to keep UX
          document.getElementById('metricsGrid').innerHTML =
            '<div class="col-span-4 bg-white p-6 rounded-lg shadow text-red-600">Failed to load metrics.</div>';
          document.getElementById('recommendationsList').innerHTML =
            '<div class="p-6 text-red-600">Failed to load recommendations.</div>';
          document.getElementById('actionPlanList').innerHTML =
            '<div class="p-6 text-red-600">Failed to load action plan.</div>';
        }
      }

      // Example: wire filters to reload charts (placeholder hooks)
      document.getElementById('salesTrendRange')?.addEventListener('change', async (e) => {
        const range = e.target.value;
        // Optionally call backend: /ai/insights/trends?salesRange=range
        document.getElementById('salesTrendChart').innerHTML =
          `<p class="text-gray-500">Sales trend (${range} days) visualization will appear here</p>`;
      });

      document.getElementById('inventoryCategory')?.addEventListener('change', async (e) => {
        const cat = e.target.value;
        // Optionally call backend: /ai/insights/inventory-health?category=cat
        document.getElementById('inventoryHealthChart').innerHTML =
          `<p class="text-gray-500">Inventory health (${cat}) visualization will appear here</p>`;
      });

      // Handle "Apply" on recommendations (you can implement a specific backend route per type)
      document.addEventListener('click', async (e) => {
        const btn = e.target.closest('.apply-reco-btn');
        if (!btn) return;
        const id = btn.dataset.id;
        try {
          // Example: POST an apply action
          await fetch(`/ai/insights/recommendations/${id}/apply`, { method: 'POST' });
          alert('Recommendation applied');
          await loadAIInsights(); // refresh after applying
        } catch (err) {
          alert('Failed to apply recommendation');
        }
      });

      // Initialize
      document.addEventListener('DOMContentLoaded', () => {
        loadAIInsights();
      });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.globe.min.js"></script>
    <script src="assets/js/resources-common.js"></script>
    <script>feather.replace();</script>
    <footer class="bg-gray-800 text-white text-center py-4 mt-8">
      <div class="max-w-7xl mx-auto px-4 flex justify-between items-center">
        <p class="text-[#3AA6A0]">&copy; 2025 WareHost. All rights reserved.</p>
        <div class="space-x-4">
          <a href="#" class="hover:text-green-400">Help</a>
          <a href="#" class="hover:text-green-400">Privacy</a>
          <a href="#" class="hover:text-green-400">Contact</a>
        </div>
      </div>
    </footer>
</body>

</html>
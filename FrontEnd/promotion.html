<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PromoGenius AI | WareHost</title>
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <link rel="stylesheet" href="assets/css/resources-common.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              500: '#6366f1',
              600: '#4f46e5',
            },
            secondary: {
              500: '#ec4899',
              600: '#db2777',
            }
          }
        }
      }
    }
  </script>
  <style>
    .promo-card {
      transition: all 0.3s ease;
      border-left: 4px solid transparent;
    }

    .promo-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      border-left-color: #6366f1;
    }

    .ai-badge {
      position: absolute;
      top: -10px;
      right: -10px;
      background: linear-gradient(135deg, #ec4899, #db2777);
      color: white;
      padding: 2px 8px;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: bold;
    }

    .product-tag {
      background-color: #e0e7ff;
      color: #4f46e5;
      padding: 2px 8px;
      border-radius: 9999px;
      font-size: 0.75rem;
    }
  </style>
</head>

<body class="bg-gray-50">
  <!-- Header with Vanta background and 3D object (animation limited to header) -->
  <header class="bg-[#3AA6A0] text-white shadow-md relative overflow-hidden">
    <div id="vanta-bg" class="absolute inset-0"></div>
    <div id="teal-3d-object"></div>
    <div class="container mx-auto px-4 py-4 flex justify-between items-center relative z-10">
      <div class="flex items-center space-x-2">
        <i data-feather="package" class="w-6 h-6"></i>
        <h1 class="text-2xl font-bold">WareHost</h1>
      </div>
      <nav class="hidden md:flex space-x-8">
        <a href="index.html" class="text-gray-200 hover:text-white px-3 py-2 text-sm font-medium">Dashboard</a>
        <a href="inventory.html" class="text-gray-200 hover:text-white px-3 py-2 text-sm font-medium">Inventory</a>
        <a href="resources.html" class="text-gray-200 hover:text-white px-3 py-2 text-sm font-medium">Resources</a>
        <a href="insights.html" class="text-gray-200 hover:text-white px-3 py-2 text-sm font-medium">AI Insights</a>
        <a href="promotions.html"
          class="text-white border-b-2 border-white px-3 py-2 text-sm font-medium">Promotions</a>
      </nav>
      <div class="hidden md:flex items-center">
        <button
          class="bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg text-sm font-medium transition duration-150">New
          Promotion</button>
      </div>
    </div>
  </header>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Header -->
    <div class="mb-10">
      <div class="flex items-center mb-4 bg-[#3AA6A0] text-white rounded-lg p-4">
        <div class="p-3 rounded-lg bg-white/10 text-white mr-4">
          <i data-feather="zap" class="h-6 w-6 text-white"></i>
        </div>
        <div>
          <h1 class="text-3xl font-bold text-white">PromoGenius AI</h1>
          <p class="text-white">Smart promotion recommendations based on your inventory and sales patterns</p>
        </div>
      </div>
      <div class="bg-blue-50 border-l-4 border-blue-500 p-4">
        <div class="flex">
          <div class="flex-shrink-0">
            <i data-feather="alert-circle" class="h-5 w-5 text-blue-500"></i>
          </div>
          <div class="ml-3">
            <p class="text-sm text-blue-700">
              Our AI has analyzed your inventory and suggests these promotions to maximize sales and clear slow-moving
              stock.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- AI Generated Promotions -->
    <div class="mb-12">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-semibold text-gray-900">AI-Generated Promotions</h2>
        <div class="flex items-center space-x-2">
          <span class="text-sm text-gray-500">Sort by:</span>
          <select id="promoSort"
            class="border-gray-300 rounded-lg text-sm focus:ring-primary-500 focus:border-primary-500">
            <option value="impact">Potential Impact</option>
            <option value="startDate">Start Date</option>
            <option value="discount">Discount %</option>
          </select>
        </div>
      </div>

      <!-- Grid container (cards will be injected here by JS) -->
      <div id="promoGrid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </div>

    <!-- Create New Section -->
    <div class="bg-white rounded-lg shadow overflow-hidden">
      <div class="p-6 border-b border-gray-200">
        <h2 class="text-xl font-semibold text-gray-900">Create New Promotion</h2>
      </div>
      <div class="p-6">
        <div class="grid md:grid-cols-3 gap-6">
          <div id="aiGeneratedBox"
            class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-primary-500 hover:bg-primary-50 transition duration-150 cursor-pointer">
            <div
              class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-primary-100 text-primary-500 mb-4">
              <i data-feather="zap"></i>
            </div>
            <h3 class="text-lg font-medium text-gray-900 mb-2">AI-Generated</h3>
            <p class="text-sm text-gray-500">Let our AI create the optimal promotion based on your inventory</p>
          </div>

          <div id="standardSaleBox"
            class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-primary-500 hover:bg-primary-50 transition duration-150 cursor-pointer">
            <div
              class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-primary-100 text-primary-500 mb-4">
              <i data-feather="star"></i>
            </div>
            <h3 class="text-lg font-medium text-gray-900 mb-2">Standard Sale</h3>
            <p class="text-sm text-gray-500">Create a basic percentage or fixed amount discount</p>
          </div>

          <div id="bundleDealBox"
            class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-primary-500 hover:bg-primary-50 transition duration-150 cursor-pointer">
            <div
              class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-primary-100 text-primary-500 mb-4">
              <i data-feather="package"></i>
            </div>
            <h3 class="text-lg font-medium text-gray-900 mb-2">Bundle Deal</h3>
            <p class="text-sm text-gray-500">Combine products for special pricing</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Promotion Create Modal (hidden by default) -->
    <div id="promoModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
      <div class="bg-white rounded-lg shadow-lg w-full max-w-md p-6">
        <h2 class="text-xl font-semibold mb-4">Create Standard Sale Promotion</h2>
        <form id="promoForm" class="space-y-4">
          <div>
            <label for="promoCode" class="block text-sm font-medium text-gray-700">Promo Code</label>
            <input type="text" id="promoCode" name="promoCode" required
              class="mt-1 block w-full border border-gray-300 rounded-md p-2">
          </div>
          <div>
            <label for="discount" class="block text-sm font-medium text-gray-700">Discount (%)</label>
            <input type="number" id="discount" name="discount" min="0" max="100" step="1" required
              class="mt-1 block w-full border border-gray-300 rounded-md p-2">
          </div>
          <div>
            <label for="startDate" class="block text-sm font-medium text-gray-700">Start Date</label>
            <input type="date" id="startDate" name="startDate" required
              class="mt-1 block w-full border border-gray-300 rounded-md p-2">
          </div>
          <div>
            <label for="endDate" class="block text-sm font-medium text-gray-700">End Date</label>
            <input type="date" id="endDate" name="endDate" required
              class="mt-1 block w-full border border-gray-300 rounded-md p-2">
          </div>
          <div class="flex justify-end space-x-2">
            <button type="button" id="cancelPromo"
              class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Cancel</button>
            <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Create</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Promotion Scripts -->
    <script>
      // Fetch and render promotions
      async function loadPromotions(sortBy = null) {
        try {
          const res = await fetch('/promotions/findAllPromotions');
          if (!res.ok) throw new Error('Failed to load promotions');
          let promotions = await res.json();

          // Optional client-side sort (adjust if backend supports query params)
          if (sortBy === 'discount') {
            promotions.sort((a, b) => (b.discount || 0) - (a.discount || 0));
          } else if (sortBy === 'startDate') {
            promotions.sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
          } // 'impact' left as-is unless you have a field to sort by

          const grid = document.getElementById('promoGrid');
          grid.innerHTML = '';

          promotions.forEach(promo => {
            const name = promo.name || promo.promoCode || 'Promotion';
            const status = promo.status || 'DRAFT';
            const start = promo.startDate || '';
            const end = promo.endDate || '';
            const discount = typeof promo.discount === 'number'
              ? promo.discount
              : (promo.discount?.amount ?? '');
            const description = promo.description || '';
            const revenue = promo.projectedRevenue ?? '';

            const card = document.createElement('div');
            card.className = 'promo-card relative bg-white rounded-lg shadow p-6';
            card.innerHTML = `
            <h3 class="font-bold text-lg text-gray-900 mb-2">${name}</h3>
            <div class="flex items-center mb-3">
              <span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded">${status}</span>
              <span class="ml-2 text-sm text-gray-500">${start}${end ? ' - ' + end : ''}</span>
            </div>
            <div class="mb-4">
              <span class="text-2xl font-bold text-primary-600">${discount}%</span>
              <span class="text-gray-500"> discount</span>
            </div>
            <div class="mb-4">
              <p class="text-sm text-gray-600">${description}</p>
            </div>
            <div class="flex justify-between items-center">
              <div>
                <span class="text-xs text-gray-500">Projected revenue:</span>
                <span class="block text-sm font-medium">${revenue ? '$' + revenue : '—'}</span>
              </div>
              <div class="flex items-center space-x-3">
                <button class="customize-btn text-primary-600 hover:text-primary-800 text-sm font-medium flex items-center" data-id="${promo.promoID || promo.id}">
                  <i data-feather="edit" class="w-4 h-4 mr-1"></i> Customize
                </button>
              </div>
            </div>
          `;
            grid.appendChild(card);
          });

          feather.replace();
        } catch (err) {
          console.error(err);
        }
      }

      // Create promotion
      async function createPromotion(promoData) {
        const res = await fetch('/promotions', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(promoData)
        });
        if (!res.ok) {
          const msg = await res.text();
          throw new Error(msg || 'Failed to create promotion');
        }
        return await res.json();
      }

      // Update promotion
      async function updatePromotion(id, updates) {
        const res = await fetch(`/promotions/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(updates)
        });
        if (!res.ok) {
          const msg = await res.text();
          throw new Error(msg || 'Failed to update promotion');
        }
        return await res.json();
      }

      // Modal open/close helpers
      function openModal() {
        const modal = document.getElementById('promoModal');
        modal.classList.remove('hidden');
        modal.classList.add('flex');
      }
      function closeModal() {
        const modal = document.getElementById('promoModal');
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        // reset form
        document.getElementById('promoForm').reset();
      }

      // Wire up "Standard Sale" box to open modal
      document.getElementById('standardSaleBox').addEventListener('click', openModal);

      // Cancel button closes modal
      document.getElementById('cancelPromo').addEventListener('click', closeModal);

      // Handle form submission (Create Standard Sale)
      document.getElementById('promoForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const promoData = {
          promoCode: document.getElementById('promoCode').value,
          discount: parseFloat(document.getElementById('discount').value),
          startDate: document.getElementById('startDate').value,
          endDate: document.getElementById('endDate').value,
          type: 'standard',
          description: 'Standard Sale Promotion'
        };
        try {
          await createPromotion(promoData);
          closeModal();
          await loadPromotions();
        } catch (err) {
          alert(err.message);
        }
      });

      // Event delegation for Customize (simple demo updates discount)
      document.addEventListener('click', async (e) => {
        const btn = e.target.closest('.customize-btn');
        if (!btn) return;
        const id = btn.dataset.id;
        try {
          // Example update — you can open another modal to capture edits
          await updatePromotion(id, { discount: 25 });
          await loadPromotions();
        } catch (err) {
          alert(err.message);
        }
      });

      // Sort dropdown
      document.getElementById('promoSort').addEventListener('change', (e) => {
        loadPromotions(e.target.value);
      });

      // Init
      document.addEventListener('DOMContentLoaded', () => {
        loadPromotions();
      });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.globe.min.js"></script>
    <script src="assets/js/resources-common.js"></script>
    <script>feather.replace();</script>
    <footer class="bg-gray-800 text-white text-center py-4 mt-8">
      <div class="max-w-7xl mx-auto px-4 flex justify-between items-center">
        <p class="text-[#3AA6A0]">&copy; 2025 WareHost. All rights reserved.</p>
        <div class="space-x-4">
          <a href="#" class="hover:text-green-400">Help</a>
          <a href="#" class="hover:text-green-400">Privacy</a>
          <a href="#" class="hover:text-green-400">Contact</a>
        </div>
      </div>
    </footer>
</body>

</html>